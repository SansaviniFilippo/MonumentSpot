<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>manager - dashboard</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://cdn.jsdelivr.net/npm/ol@v9.1.0/ol.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/ol@v9.1.0/dist/ol.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles/manager_dashboard.css">
</head>
<body>
  <div class="cdash">
    <header class="head">
      <div>
        <h1 class="title">Manager <br/>Dashboard</h1>
        <p class="subtitle">Manage your museum's<br/>artwork collection</p>
      </div>
      <button id="signOutBtn" class="signout" type="button" title="Sign Out">
        <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M16 17l5-5-5-5v3H9v4h7v3z" opacity=".9"/><path d="M4 5h7a1 1 0 011 1v2h-2V7H6v10h4v-1h2v2a1 1 0 01-1 1H4a2 2 0 01-2-2V7a2 2 0 012-2z" opacity=".6"/></svg>
        <span>Sign Out</span>
      </button>
    </header>

    <nav class="tabs" role="tablist" aria-label="Sections">
      <button class="tab active" role="tab" aria-selected="true">Add Artwork</button>
      <button class="tab" role="tab" aria-selected="false">Manage Collection</button>
    </nav>

    <section id="addSection" class="card" aria-labelledby="addTitle">
      <h2 id="addTitle">Add New Artwork</h2>

      <form id="f">
        <label class="lbl" for="images">Artwork Images</label>
        <input id="images" type="file" name="images" accept="image/png,image/jpeg" multiple required />
        <div id="drop" class="dropzone" tabindex="0" role="button" aria-controls="images">
          <svg class="upl" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 3l4 4h-3v7h-2V7H8l4-4z" opacity=".7"/><path d="M5 13h2v6h10v-6h2v6a2 2 0 01-2 2H7a2 2 0 01-2-2v-6z" opacity=".4"/></svg>
          <strong>Click to upload</strong>
          <small></small>
        </div>
        <div id="previews" class="previews" aria-live="polite" aria-label="Anteprima immagini selezionate"></div>

        <div class="field">
          <label class="lbl" for="name">Name</label>
          <input id="name" class="input" name="name" placeholder="Enter monument name" />
        </div>

        <div class="field">
          <label class="lbl" for="artist">Artist</label>
          <input id="artist" class="input" name="artist" placeholder="Enter artist name" />
        </div>
        <div class="field">
          <label class="lbl" for="year">Year</label>
          <input id="year" class="input" name="year" placeholder="e.g., 1620 ca." />
        </div>
        <div class="field">
          <label class="lbl" for="desc_it">IT description</label>
          <textarea id="desc_it" class="textarea" name="desc_it" placeholder="Descrizione in italiano"></textarea>
        </div>
        <div class="field">
          <label class="lbl" for="desc_en">EN description</label>
          <textarea id="desc_en" class="textarea" name="desc_en" placeholder="Description in English"></textarea>
        </div>
        <!-- Bottone per aprire la mappa -->
        <div class="actions" style="justify-content:flex-start; gap:10px;">
          <button id="openMapBtn" class="btn-map-open" type="button">üåç Apri Mappa</button>
          <small id="mapHint" style="color:#6b7a94;">Seleziona un punto o un poligono sulla mappa</small>
        </div>

        <!-- (Opzionale ma utile) input hidden per salvare l'array di coordinate in JSON -->
        <input type="hidden" id="location_coords" name="location_coords" />


        <div class="actions">
          <button id="submitBtn" class="btn-primary" type="submit">Save Artwork</button>
          <div id="statusMsg" aria-live="polite"></div>
        </div>
      </form>
    </section>

    <section id="manageSection" class="card" aria-labelledby="mgmtTitle" style="display:none">
      <div class="mgmt-head">
        <h2 id="mgmtTitle">Collection Management</h2>
        <div class="mgmt-count"><span id="mgmtCount">0</span> artworks in collection</div>
      </div>
      <div class="table-wrap">
        <table id="collectionTable" class="mgmt-table" aria-describedby="mgmtTitle">
          <thead>
            <tr>
              <th>Name</th>
              <th>Images</th>
              <th class="actions-col"></th>
            </tr>
          </thead>
          <tbody id="collectionBody"></tbody>
        </table>
      </div>
    </section>
  </div>

  <!-- TensorFlow.js and MobileNet -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.20.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@2.1.0"></script>

  <script>
      if (!window.BACKEND_URL) {
          const isLocalhost = location.hostname === "localhost" || location.hostname === "127.0.0.1";
          window.BACKEND_URL = isLocalhost
              ? "/api"  // backend locale
              : "https://monulens-production.up.railway.app"; // backend produzione
      }
  </script>

  <!-- Overlay Mappa (inizialmente nascosto) -->
  <div id="mapOverlay" class="md-overlay" style="display:none;">
      <div class="md-card" style="width:min(980px, 96%); padding:0; overflow:hidden;">

          <div class="md-header">
              <button id="closeMapBtn" class="md-close" title="Chiudi" aria-label="Chiudi">‚úñ</button>
          </div>

          <!-- Corpo: controlli + mappa -->
          <div class="md-body" style="padding:0;">
              <!-- Controlli mappa (layout 2x2 + conferma) -->
              <div id="mapControls">
                  <button id="drawBtn" class="btn-primary" type="button" style="min-height:40px; background:#fff7da; color:#9a7d0a; border:2px solid #f1c40f;">‚úèÔ∏è Poligono</button>
                  <button id="undoBtn" class="btn-primary" type="button" style="min-height:40px; background:#eef6ff; color:#0047b3; border:2px solid #4b8fff;">‚Ü©Ô∏è Annulla</button>
                  <button id="addPointBtn" class="btn-primary" type="button" style="min-height:40px; background:#e6fff5; color:#0a8f6a; border:2px solid #1abc9c;">üìç Punto</button>
                  <button id="clearBtn" class="btn-primary" type="button" style="min-height:40px; background:#fff4f4; color:#b31313; border:2px solid #d91c1c;">üóëÔ∏è Cancella</button>
                  <button id="confirmBtn" class="btn-primary" type="button" style="grid-column:1 / -1; min-height:44px; background:#2fbf71; border:2px solid #25a460;">
                      ‚úÖ Conferma coordinate
                  </button>
              </div>

              <!-- Area mappa -->
              <div id="map" style="height:70vh; min-height:480px;"></div>
          </div>
      </div>
  </div>


  <script type="module" src="../src/js/manager_dashboard.js"></script>
</body>
</html>
